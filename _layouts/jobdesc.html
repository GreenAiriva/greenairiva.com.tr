<!DOCTYPE html>
<html lang="{{ page.lang | default: 'en' }}">
  {% include head.html %}
  <body id="page-top">
    {% if page.lang == "tr" %}
      {% include header_tr.html %}
    {% else %}
      {% include header.html %}
    {% endif %}

    {{ content }}

    {% if page.lang == "tr" %}
      {% include footer_tr.html %}
    {% else %}
      {% include footer.html %}
    {% endif %}

    <!-- Universal Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/yourfontawesomekit.js" crossorigin="anonymous"></script>
    <script src="{{ site.baseurl }}/js/scripts.js"></script>

    <!-- İş Detayı Dinamik Yükleyici Script -->
    <script>
    document.addEventListener('DOMContentLoaded', function () {
      const params = new URLSearchParams(window.location.search);
      const slug = params.get('slug');
      if (!slug) return;

      // Doğru JSON dosyası seçimi (dil kontrolü)
      const jsonPath = '{{ page.lang }}' === 'tr'
        ? '{{ site.baseurl }}/career/tr/jobs.json'
        : '{{ site.baseurl }}/career/jobs.json';

      fetch(jsonPath)
        .then(response => {
          if (!response.ok) throw new Error("❌ JSON yüklenemedi: " + response.status);
          return response.json();
        })
        .then(jobs => {
          const job = jobs.find(j => (j.slug || '').toLowerCase() === slug.toLowerCase());
          if (!job) {
            const nf = document.getElementById('article-notfound');
            if (nf) nf.style.display = 'block';
            const single = document.querySelector('.job-single');
            if (single) single.style.display = 'none';
            return;
          }

          // Başlık ve meta alanlarını doldur
          const titleHead = document.getElementById('article-title-head');
          if (titleHead) titleHead.textContent = job.title || '';

          const locationHead = document.getElementById('article-location-head');
          if (locationHead) locationHead.textContent = job.location || '';

          const typeHead = document.getElementById('article-type-head');
          if (typeHead) typeHead.textContent = job.type || '';

          // Markdown içeriğini yükle ve göster
          if (job.url) {
            const mdUrl = '{{ site.baseurl }}' + job.url;
            fetch(mdUrl)
              .then(res => {
                if (!res.ok) throw new Error('❌ Markdown bulunamadı: ' + res.status);
                return res.text();
              })
              .then(md => {
                if (window.marked) {
                  document.getElementById('article-content').innerHTML = marked.parse(md);
                } else {
                  document.getElementById('article-content').textContent = md;
                }
              })
              .catch(err => {
                const nf = document.getElementById('article-notfound');
                if (nf) nf.style.display = 'block';
              });
          }
        })
        .catch(err => {
          const nf = document.getElementById('article-notfound');
          if (nf) nf.style.display = 'block';
        });
    });
    </script>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </body>
</html>
